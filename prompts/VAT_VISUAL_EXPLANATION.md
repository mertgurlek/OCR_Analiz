# VAT Calculation - Visual Step-by-Step Guide

## ğŸ¯ The Core Concept

Turkish receipts show **KDV Dahil** (VAT-included) prices. You must **extract** the hidden VAT.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  What You See on Receipt:               â”‚
â”‚  "Motorin: 118â‚º"                        â”‚
â”‚                                          â”‚
â”‚  What It Actually Means:                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Base: 100â‚º   â”‚ VAT: 18â‚º â”‚ = 118â‚º    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚   (Hidden)      (Hidden)   (Shown)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ The Math

### Single Item Calculation

```
Receipt Shows: 118â‚º @ 18% VAT

Step 1: Calculate VAT Amount
        VAT = 118 / (1 + 0.18) Ã— 0.18
        VAT = 118 / 1.18 Ã— 0.18
        VAT = 100 Ã— 0.18
        VAT = 18â‚º

Step 2: Calculate Base Amount
        Base = 118 - 18 = 100â‚º

Verification: 100 + 18 = 118â‚º âœ“
```

### Visual Formula

```
        Receipt Price
             â”‚
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  118â‚º   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Ã· 1.18 (divide by 1 + rate)
             â”‚
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  100â‚º   â”‚ â—„â”€â”€ This is the BASE
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Ã— 0.18 (multiply by rate)
             â”‚
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   18â‚º   â”‚ â—„â”€â”€ This is the VAT
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¢ Multiple Items Example

### Receipt:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AKARYAKIT FÄ°ÅÄ°              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Motorin 50L      1,742.25â‚º  â”‚ â† 10% VAT
â”‚ Kahve Grande        45.00â‚º  â”‚ â† 18% VAT  
â”‚ Ã‡ikolata            15.00â‚º  â”‚ â† 18% VAT
â”‚ Su 1.5L              8.50â‚º  â”‚ â† 8% VAT
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOPLAM           1,810.75â‚º  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 1: Parse Each Item

```
Item 1: Motorin - 1,742.25â‚º @ 10%
  VAT = 1742.25 / 1.10 Ã— 0.10 = 158.39â‚º
  Base = 1742.25 - 158.39 = 1,583.86â‚º

Item 2: Kahve - 45â‚º @ 18%
  VAT = 45 / 1.18 Ã— 0.18 = 6.86â‚º
  Base = 45 - 6.86 = 38.14â‚º

Item 3: Ã‡ikolata - 15â‚º @ 18%
  VAT = 15 / 1.18 Ã— 0.18 = 2.29â‚º
  Base = 15 - 2.29 = 12.71â‚º

Item 4: Su - 8.50â‚º @ 8%
  VAT = 8.50 / 1.08 Ã— 0.08 = 0.63â‚º
  Base = 8.50 - 0.63 = 7.87â‚º
```

### Step 2: Group by VAT Rate

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8% KDV Group                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Su                                     â”‚
â”‚ Base: 7.87â‚º + VAT: 0.63â‚º = 8.50â‚º     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10% KDV Group                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Motorin                                â”‚
â”‚ Base: 1,583.86â‚º + VAT: 158.39â‚º        â”‚
â”‚ Total: 1,742.25â‚º                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 18% KDV Group                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Kahve:    Base: 38.14â‚º + VAT: 6.86â‚º  â”‚
â”‚ Ã‡ikolata: Base: 12.71â‚º + VAT: 2.29â‚º  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTALS:   Base: 50.85â‚º + VAT: 9.15â‚º  â”‚
â”‚           Total: 60.00â‚º                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 3: Final VAT Breakdown

```json
{
  "vatBreakdown": [
    {
      "vatRate": 8,
      "taxBase": 7.87,
      "vatAmount": 0.63,
      "totalAmount": 8.50
    },
    {
      "vatRate": 10,
      "taxBase": 1583.86,
      "vatAmount": 158.39,
      "totalAmount": 1742.25
    },
    {
      "vatRate": 18,
      "taxBase": 50.85,
      "vatAmount": 9.15,
      "totalAmount": 60.00
    }
  ],
  "totalVat": 168.17,
  "totalAmount": 1810.75
}
```

### Verification:
```
âœ“ 8.50 + 1742.25 + 60.00 = 1,810.75 (matches receipt)
âœ“ 0.63 + 158.39 + 9.15 = 168.17 (total VAT)
âœ“ All items properly grouped by rate
```

---

## ğŸš¨ Common Error Example

### âŒ WRONG WAY (adding VAT on top):

```
Motorin: 1,742.25â‚º @ 10%
WRONG: VAT = 1,742.25 Ã— 0.10 = 174.23â‚º
       Total = 1,742.25 + 174.23 = 1,916.48â‚º
       
âŒ This is WRONG! Receipt already shows 1,742.25â‚º as final price!
```

### âœ… RIGHT WAY (extracting included VAT):

```
Motorin: 1,742.25â‚º @ 10%
RIGHT: VAT = 1,742.25 / 1.10 Ã— 0.10 = 158.39â‚º
       Base = 1,742.25 - 158.39 = 1,583.86â‚º
       
âœ“ This is CORRECT! 1,583.86 + 158.39 = 1,742.25â‚º
```

---

## ğŸ“ Quick Reference Card

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VAT EXTRACTION FORMULA                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Given: Receipt Price = P, VAT Rate = Râ”‚
â”‚                                         â”‚
â”‚  VAT Amount = P / (1 + R) Ã— R          â”‚
â”‚                                         â”‚
â”‚  Base Amount = P - VAT Amount          â”‚
â”‚                                         â”‚
â”‚  Or simplified:                         â”‚
â”‚  Base Amount = P / (1 + R)             â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EXAMPLES:                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10% VAT: VAT = Price / 1.10 Ã— 0.10     â”‚
â”‚ 18% VAT: VAT = Price / 1.18 Ã— 0.18     â”‚
â”‚ 20% VAT: VAT = Price / 1.20 Ã— 0.20     â”‚
â”‚  8% VAT: VAT = Price / 1.08 Ã— 0.08     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ Memory Aid

Think of it like this:

```
The receipt price is a "gift box" ğŸ

Inside the box:
  ğŸ“¦ Base Amount (the actual product value)
  +
  ğŸ€ VAT Amount (the tax ribbon on top)
  =
  ğŸ Total Price (what you see)

Your job: Unwrap the gift to see what's inside!

Formula to unwrap:
  Base (ğŸ“¦) = Gift (ğŸ) / (1 + tax rate)
  VAT (ğŸ€) = Gift (ğŸ) - Base (ğŸ“¦)
```

---

## ğŸ¯ Final Checklist

When you parse a receipt:

- [ ] For EACH item: Calculate VAT using `price / (1 + rate) Ã— rate`
- [ ] Group items by VAT rate (don't create one entry per item!)
- [ ] Sum up bases and VAT amounts for each rate group
- [ ] Verify: Total of all items = Receipt's grand total
- [ ] Allow small rounding differences (Â±0.50â‚º)
- [ ] Return clear, structured JSON

**Remember**: Turkish prices are like icebergs - the VAT is hidden beneath the surface! ğŸ§Š
