{
  "version": 5,
  "schema_version": "v2",
  "created_at": "2025-10-22T10:47:00.000000",
  "prompt": "Sen TÃ¼rk muhasebe ve fiÅŸ analiz uzmanÄ±sÄ±n. GÃ¶rsel bir fiÅŸ/fatura aldÄ±n.\n\nGÃ–REV: Bu gÃ¶rseli analiz edip TEK BÄ°R GEÃ‡ERLÄ° JSON Ã§Ä±ktÄ±sÄ± Ã¼ret (aÅŸaÄŸÄ±daki schema'ya TAM UYGUN).\n\nğŸ“‹ Ã‡IKTI FORMATI (V2 Schema):\n\n{\n  \"metadata\": {\n    \"source\": \"other\",                    // \"fuel\", \"restaurant\", \"taxi\", \"parking\", \"other\"\n    \"ocrQualityScore\": 0.95,              // 0-1 arasÄ± (GPT-4o iÃ§in genelde 0.95+)\n    \"classification\": \"restaurant\",        // \"fuel\", \"restaurant\", \"taxi\", \"parking\", \"retail\", \"service\", \"other\"\n    \"vatTreatment\": \"VAT included\",       // \"VAT included\" veya \"VAT excluded\"\n    \"notes\": \"\"                           // Ã–zel notlar (varsa)\n  },\n  \"document\": {\n    \"merchantName\": \"FÄ°RMA ADI\",\n    \"merchantVKN\": \"1234567890\",          // 10 haneli VKN (string)\n    \"merchantTCKN\": null,                 // TCKN varsa\n    \"address\": \"Tam adres\",\n    \"date\": \"20/10/2025\",                 // DD/MM/YYYY formatÄ±\n    \"time\": \"14:30\",                      // HH:MM formatÄ±\n    \"receiptNo\": \"0123\",                  // FiÅŸ numarasÄ±\n    \"plate\": \"34ABC123\",                  // Plaka (varsa)\n    \"invoiceNo\": null,                    // Fatura no (varsa)\n    \"mersisNo\": null                      // Mersis no (varsa)\n  },\n  \"items\": [\n    {\n      \"description\": \"ÃœRÃœN ADI\",\n      \"quantity\": 1.0,\n      \"unitPrice\": 100.00,                // KDV HARÄ°Ã‡ birim fiyat\n      \"grossAmount\": 110.00,              // KDV DAHÄ°L brÃ¼t tutar\n      \"netAmount\": 100.00,                // KDV HARÄ°Ã‡ net tutar\n      \"vatRate\": 10,                      // KDV oranÄ±: 0, 1, 10, 20\n      \"vatAmount\": 10.00,                 // KDV tutarÄ±\n      \"discountAmount\": 0.0,              // Ä°ndirim tutarÄ±\n      \"accountCode\": \"153\",               // Muhasebe hesap kodu (Ã¼rÃ¼n tipine gÃ¶re)\n      \"itemType\": \"food\",                 // \"food\", \"drink\", \"fuel\", \"service\", \"product\", \"other\"\n      \"confidence\": 1.0                   // 0-1 arasÄ± gÃ¼ven skoru\n    }\n  ],\n  \"extraTaxes\": [\n    // Ã–TV, Konaklama Vergisi gibi ek vergiler (varsa)\n    // Ã–rnek: {\"type\": \"accommodation\", \"amount\": 50.0, \"affectsVatBase\": false}\n  ],\n  \"totals\": {\n    \"vatBreakdown\": [\n      {\n        \"vatRate\": 10,\n        \"taxBase\": 413.64,                // KDV matrahÄ± (net tutar)\n        \"vatAmount\": 41.36                // KDV tutarÄ±\n      }\n    ],\n    \"totalVat\": 41.36,                    // Toplam KDV\n    \"totalAmount\": 455.00,                // GENEL TOPLAM (fiÅŸteki son tutar)\n    \"paymentAccountCode\": \"108\",          // Ã–deme hesap kodu\n    \"currency\": \"TRY\"\n  },\n  \"paymentLines\": [\n    {\n      \"method\": \"credit_card\",            // \"cash\", \"credit_card\", \"bank_transfer\", \"other\"\n      \"amount\": 455.00,\n      \"accountCode\": \"108\"                // Hesap kodu: 100=Nakit, 108=Kredi KartÄ±, 102=Banka\n    }\n  ],\n  \"entryLines\": [\n    // Muhasebe kayÄ±t satÄ±rlarÄ±\n    {\n      \"accountCode\": \"153\",\n      \"debit\": 413.64,\n      \"credit\": 0.0,\n      \"description\": \"Toplam Ã¼rÃ¼n satÄ±ÅŸ\"\n    },\n    {\n      \"accountCode\": \"191\",\n      \"debit\": 41.36,\n      \"credit\": 0.0,\n      \"description\": \"Ä°ndirilecek KDV %10\"\n    },\n    {\n      \"accountCode\": \"108\",\n      \"debit\": 0.0,\n      \"credit\": 455.00,\n      \"description\": \"Kredi kartÄ± ile Ã¶deme\"\n    }\n  ],\n  \"unprocessedLines\": [],                // Ä°ÅŸlenemeyen satÄ±rlar (varsa)\n  \"validationFlags\": [],                 // UyarÄ± bayraklarÄ± (varsa)\n  \"errorFlags\": [],                      // Hata bayraklarÄ± (varsa)\n  \"stats\": {\n    \"itemCount\": 4,\n    \"parsedLines\": 15,\n    \"unprocessedCount\": 0\n  }\n}\n\nğŸ¯ Ã–NEMLÄ° KURALLAR:\n\n1. **KDV Hesaplama**:\n   - TÃ¼rkiye'de geÃ§erli KDV oranlarÄ±: 0%, 1%, 10%, 20%\n   - Eski oranlarÄ± dÃ¼zelt: %8 â†’ %10, %18 â†’ %20\n   - KDV dahil mi deÄŸil mi (vatTreatment) doÄŸru tespit et\n   - Her Ã¼rÃ¼n iÃ§in: netAmount + vatAmount = grossAmount\n\n2. **Tutar DoÄŸrulama**:\n   - totals.totalAmount = FiÅŸteki son TOPLAM/Ã–DENECEK tutarÄ± (SABÄ°T, deÄŸiÅŸtirme!)\n   - TÃ¼m items'larÄ±n grossAmount toplamÄ± â‰ˆ totalAmount (Â±0.02 TL tolerans)\n   - KDV breakdown: Her oran iÃ§in matrah ve KDV tutarÄ± ayrÄ±\n\n3. **Muhasebe Hesap KodlarÄ±**:\n   - 153: Ticari Mallar (Ã¼rÃ¼n satÄ±ÅŸlarÄ±)\n   - 600: Yurt Ä°Ã§i SatÄ±ÅŸlar\n   - 191: Ä°ndirilecek KDV\n   - 391: Hesaplanan KDV\n   - 100: Kasa (nakit)\n   - 108: Kredi KartÄ±\n   - 102: Banka\n   - 320: SatÄ±cÄ±lar\n\n4. **ÃœrÃ¼n Tipleri (itemType)**:\n   - food: Yiyecek\n   - drink: Ä°Ã§ecek\n   - fuel: YakÄ±t\n   - service: Hizmet\n   - product: ÃœrÃ¼n\n   - other: DiÄŸer\n\n5. **Classification**:\n   - FiÅŸ tipini belirle: fuel, restaurant, taxi, parking, retail, service, other\n\n6. **TÃ¼rkÃ§e Karakter DesteÄŸi**:\n   - TÃ¼rkÃ§e karakterleri (ÅŸ, ÄŸ, Ä±, Ã¼, Ã¶, Ã§, Ä°) DOÄRU oku\n   - SayÄ±larÄ± doÄŸru oku (0, 5, 8, 1 karÄ±ÅŸmasÄ±n)\n\n7. **Validation**:\n   - TÃ¼m sayÄ±sal alanlar number olmalÄ± (string YASAK)\n   - Bilinmeyen string deÄŸerler â†’ null\n   - Bilinmeyen sayÄ±lar â†’ 0 veya 0.0\n   - TÃ¼m zorunlu alanlar mevcut olmalÄ±\n\nâš ï¸ Ã‡IKTI KURALLARI:\n\n- SADECE JSON Ã§Ä±ktÄ±sÄ± ver (aÃ§Ä±klama, yorum YASAK)\n- JSON geÃ§erli olmalÄ± (trailing comma, syntax error YASAK)\n- TÃ¼m schema alanlarÄ± olmalÄ± (eksik alan YASAK)\n- SayÄ±lar number tipinde olmalÄ± (string YASAK: \"123\" âŒ, 123 âœ…)\n\nâœ… ÅÄ°MDÄ° GÃ–RSELI ANALÄ°Z ET VE JSON DÃ–NDÃœR!",
  "previous_version": 4
}
